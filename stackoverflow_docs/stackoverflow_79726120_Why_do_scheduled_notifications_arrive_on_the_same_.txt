Stack Overflow Question: Why do scheduled notifications arrive on the same day?
Question ID: 79726120
Score: 1
Views: 28
Answers: 1
Tags: flutter, push-notification, notifications, flutter-local-notification
URL: https://stackoverflow.com/questions/79726120

QUESTION:
I'm trying to schedule a notification for several days in advance, including today, but all scheduled notifications are coming today. This is my code: import 'package:flutter_local_notifications/flutter_local_notifications.dart'; import 'package:timezone/timezone.dart' as tz; import 'package:timezone/data/latest.dart' as tz; import 'package:flutter_timezone/flutter_timezone.dart'; class NotiService { final notificationsPlugin = FlutterLocalNotificationsPlugin(); Map<String, List<int>> scheduledNotificationIds = {}; bool _isInitialized = false; bool get isInitialized => _isInitialized; // INITIALIZE Future<void> initNotification() async { if (_isInitialized) return; // prevent re-initialization // init timezone handling tz.initializeTimeZones(); final String currentTimeZone = await FlutterTimezone.getLocalTimezone(); tz.setLocalLocation(tz.getLocation(currentTimeZone)); // prepare android init settings const initSettingsAndroid = AndroidInitializationSettings( '@mipmap/ic_launcher', ); // prepare ios init settings const initSettingsIOS = DarwinInitializationSettings( requestAlertPermission: true, requestBadgePermission: true, requestSoundPermission: true, ); // init settings const initSettings = InitializationSettings( android: initSettingsAndroid, iOS: initSettingsIOS, ); // finally, initialize the plugin! await notificationsPlugin.initialize(initSettings); } // NOTIFICATIONS DETAIL SETUP NotificationDetails notificationDetails() { return const NotificationDetails( android: AndroidNotificationDetails( 'daily_channeLid', 'Daily Notifications', channelDescription: 'Daily Notification Channel', importance: Importance.max, priority: Priority.high, ), iOS: DarwinNotificationDetails(), ); } // SHOW NOTIFICATION Future<void> showNotification({ int id = 0, String? title, String? body, }) async { return notificationsPlugin.show( id, title, body, const NotificationDetails(), ); } /* Schedule a notification at a specified time (e.g. 11pm) - hour (0-23) - minute (0-59) */ Future<void> scheduleNotification({ int ?id, required String title, required String body, required int hour, required int minute, required DateTime date, }) async { final now = tz.TZDateTime.now(tz.local); var scheduledDate = tz.TZDateTime( tz.local, date.year, date.month, date.day, hour, minute, ); if (scheduledDate.isBefore(now)) { scheduledDate = scheduledDate.add(Duration(days: 1)); } await notificationsPlugin.zonedSchedule( id!, title, body, scheduledDate, notificationDetails(), androidScheduleMode: AndroidScheduleMode.inexactAllowWhileIdle, matchDateTimeComponents: DateTimeComponents.time, ); } // Cancel all notifications Future<void> cancelAllNotifications() async { await notificationsPlugin.cancelAll(); } Future<void> scheduleNotifications(String medicineName, int count, DateTime nextDose) async { DateTime now = DateTime.now(); int baseId = 1; for (int i = 0; i < count; i++) { DateTime notificationDate = DateTime( nextDose.year, nextDose.month, nextDose.day + i, nextDose.hour, nextDose.minute, ); if (notificationDate.isBefore(now)) { continue; } int notificationId = baseId + i; scheduledNotificationIds[medicineName]?.add(notificationId); await scheduleNotification.( id: notificationId, title: 'Уведомление для $medicineName', body: 'Время принять $medicineName', hour: notificationDate.hour, minute: notificationDate.minute, date: notificationDate, ); } } Future<void> cancelAllScheduledNotifications(String medicineName) async { if (scheduledNotificationIds.containsKey(medicineName)) { for (int id in scheduledNotificationIds[medicineName]!) { await notificationsPlugin.cancel(id); } scheduledNotificationIds.remove(medicineName); } } } When a notification is called at the scheduled time, all notifications are called. I expected the messages to be called on the scheduled date. Let's say if I create a scheduled notification for 12:20 every 10 days, then at 12:20 there will not be one, but all 10 scheduled for 10 days in advance. In this case, they are planned for the following days flutter: Planning notification for Cipralex: 2025-08-05 13:52:00.000 with ID: 1 flutter: Planning notification for Cipralex: 2025-08-06 13:52:00.000 with ID: 2 flutter: Planning notification for Cipralex: 2025-08-07 13:52:00.000 with ID: 3 flutter: Planning notification for Cipralex: 2025-08-08 13:52:00.000 with ID: 4 flutter: Planning notification for Cipralex: 2025-08-09 13:52:00.000 with ID: 5

ANSWERS:

Answer 1 (Score: 1, ID: 79726311):
https://stackoverflow.com/a/79726311

Change the value of matchDateTimeComponents in your schedule notification function. If you want a schedule notification to match both date and time, you should use matchDateTimeComponents: DateTimeComponents.dateAndTime Let me know if that helped in comments.

--------------------------------------------------------------------------------

